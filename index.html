<!DOCTYPE html>
<html lang="fr" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sant√©+ - Plateforme de sant√© professionnelle</title>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    :root{
      --bg-1:#f5f9ff; --bg-2:#edf4ff; --bg-3:#eef2ff;
      --card:rgba(255,255,255,.92);
      --text:#0f172a; --muted:#475569; --muted2:#64748b;
      --primary:#2563eb; --accent:#4f46e5;
      --border:rgba(148,163,184,.35);
      --ring:rgba(37,99,235,.25);
      --shadow-sm:0 1px 2px rgba(15,23,42,.06);
      --shadow-md:0 12px 28px rgba(15,23,42,.10);
      --r-lg:16px; --r-md:12px;

      --good-bg:#ecfdf5; --good-bd:#bbf7d0; --good-tx:#166534;
      --warn-bg:#fffbeb; --warn-bd:#fde68a; --warn-tx:#92400e;
      --bad-bg:#fef2f2;  --bad-bd:#fecaca;  --bad-tx:#991b1b;
      --info-bg:#eff6ff; --info-bd:#bfdbfe; --info-tx:#1e40af;

      --tabBg: rgba(37,99,235,.08);
      --tabBd: rgba(37,99,235,.12);
      --cardBd: rgba(148,163,184,.22);
      --tableHeadBg: rgba(37,99,235,.06);
      --rowHover: rgba(37,99,235,.05);
      --icon: #334155;
      --headerBg: rgba(255,255,255,.72);
      --btnBd: rgba(37,99,235,.22);
    }

    html[data-theme="dark"]{
      --bg-1:#0b1220; --bg-2:#0b1220; --bg-3:#0f172a;
      --card: rgba(17,24,39,.72);
      --text:#e5e7eb; --muted:#cbd5e1; --muted2:#94a3b8;
      --border: rgba(148,163,184,.18);
      --shadow-sm: 0 1px 2px rgba(0,0,0,.35);
      --shadow-md: 0 18px 38px rgba(0,0,0,.35);

      --tabBg: rgba(255,255,255,.06);
      --tabBd: rgba(255,255,255,.10);
      --cardBd: rgba(255,255,255,.10);
      --tableHeadBg: rgba(255,255,255,.06);
      --rowHover: rgba(255,255,255,.05);
      --icon: #cbd5e1;
      --headerBg: rgba(17,24,39,.72);
      --btnBd: rgba(255,255,255,.14);
    }

    *{margin:0;padding:0;box-sizing:border-box}
    body{
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
      background:
        radial-gradient(1000px 600px at 15% 10%, rgba(37,99,235,.12), transparent 55%),
        radial-gradient(900px 500px at 85% 20%, rgba(79,70,229,.12), transparent 60%),
        linear-gradient(135deg, var(--bg-1) 0%, var(--bg-2) 45%, var(--bg-3) 100%);
      min-height:100vh;
      color:var(--text);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    /* Header */
    .header{
      position: sticky; top:0; z-index:10;
      background: var(--headerBg);
      backdrop-filter: blur(14px);
      border-bottom: 1px solid var(--border);
      box-shadow: var(--shadow-sm);
    }
    .header-content{
      max-width:1600px; margin:0 auto;
      padding: 14px 24px;
      display:flex; align-items:center; justify-content:space-between;
      gap:16px;
    }
    .logo{display:flex; align-items:center; gap:12px;}
    .logo-icon{
      width:42px;height:42px;border-radius:14px;
      display:flex;align-items:center;justify-content:center;
      background: linear-gradient(135deg, var(--primary), var(--accent));
      box-shadow: 0 10px 18px rgba(37,99,235,.20);
      border: 1px solid rgba(255,255,255,.25);
    }
    .logo-icon i{color:#fff;font-size:20px}
    .logo-text h1{font-size:16px;font-weight:900;letter-spacing:.2px;line-height:1.1}
    .logo-text p{font-size:12px;color:var(--muted2);margin-top:2px;font-weight:600}

    .header-actions{display:flex;align-items:center;gap:8px}
    .icon-btn{
      width:40px;height:40px;border-radius:10px;
      border:1px solid transparent;background:transparent;
      display:flex;align-items:center;justify-content:center;
      cursor:pointer; transition:.2s;
      color: var(--icon);
    }
    .icon-btn:hover{background: rgba(37,99,235,.08); border-color: rgba(37,99,235,.15)}
    .icon-btn:focus-visible{outline:none; box-shadow:0 0 0 4px var(--ring); border-color: rgba(37,99,235,.35)}
    .icon-btn i{color:var(--icon);font-size:16px}

    .container{max-width:1600px;margin:0 auto;padding: 22px 24px 52px;}
    .page-header{margin: 18px 0 16px;}
    .page-header h2{font-size:34px;font-weight:950;letter-spacing:-.4px;margin-bottom:6px}
    .page-header p{font-size:15px;color:var(--muted);font-weight:650;display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding: 6px 10px; border-radius:999px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,.10);
      font-weight:900; font-size:12px; color: var(--muted);
    }
    html[data-theme="light"] .pill{ background: rgba(255,255,255,.60); }

    /* Tabs / navigation */
    .tabsbar{
      display:flex; align-items:center; justify-content:space-between;
      gap:12px; margin: 12px 0 18px;
    }
    .hint{ color: var(--muted2); font-size: 12px; font-weight: 800; }

    .tabs{
      position: relative;
      display:flex; gap:6px;
      background: var(--tabBg);
      border:1px solid var(--tabBd);
      padding:6px;
      border-radius: 14px;
      overflow: hidden;
      align-items:center;
    }
    .tab-indicator{
      position:absolute;
      top:6px;
      left:6px;
      height: calc(100% - 12px);
      width: 120px;
      border-radius: 12px;
      background: linear-gradient(135deg, var(--primary), var(--accent));
      box-shadow: 0 10px 18px rgba(37,99,235,.18);
      transition: transform .22s ease, width .22s ease;
      z-index: 0;
    }
    .tab{
      position: relative;
      z-index: 1;
      display:flex; align-items:center; gap:10px;
      padding: 10px 14px;
      border-radius: 12px;
      border:1px solid transparent;
      background: transparent;
      color: var(--icon);
      cursor:pointer;
      font-weight:950;
      font-size: 13px;
      letter-spacing:.1px;
      transition: color .2s, background .2s, border-color .2s;
      white-space:nowrap;
      user-select:none;
    }
    .tab i{font-size:14px; opacity:.9}
    .tab:hover{ background: rgba(255,255,255,.10); border-color: rgba(148,163,184,.22); }
    html[data-theme="light"] .tab:hover{ background: rgba(255,255,255,.55); }
    .tab[aria-selected="true"]{ color:#fff; }
    .tab:focus-visible{ outline:none; box-shadow:0 0 0 4px var(--ring); }

    /* Pages */
    .page{
      display:none;
      border-radius: var(--r-lg);
      background: var(--card);
      border: 1px solid var(--border);
      box-shadow: var(--shadow-md);
      padding: 18px;
      opacity: 0;
      transform: translateY(10px);
    }
    .page.active{ display:block; animation: pageIn .22s ease forwards; }
    @keyframes pageIn{ to{ opacity:1; transform: translateY(0); } }

    /* Layout utilities */
    .grid-2{display:grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap:14px}
    .grid-3{display:grid; grid-template-columns: repeat(3, minmax(0, 1fr)); gap:14px}
    .grid-auto{display:grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap:14px}
    @media (max-width: 1200px){ .grid-3{ grid-template-columns: 1fr; } }
    @media (max-width: 1100px){ .grid-2{ grid-template-columns: 1fr; } }
    @media (max-width: 900px){
      .tabsbar{flex-direction:column; align-items:flex-start}
      .page-header h2{font-size:28px}
    }

    /* Cards */
    .card{
      background: rgba(255,255,255,.10);
      border:1px solid var(--cardBd);
      border-radius: 14px;
      padding: 14px;
      box-shadow: var(--shadow-sm);
    }
    html[data-theme="light"] .card{
      background: rgba(255,255,255,.85);
      border-color: rgba(148,163,184,.22);
    }
    .section-head{
      display:flex; align-items:flex-end; justify-content:space-between;
      gap:14px; margin-bottom: 12px;
    }
    .section-head h3{ font-size:18px; font-weight:950; letter-spacing:-.2px; }
    .section-head p{ color: var(--muted); font-weight:650; font-size: 13px; }

    .card-title{
      font-size:12px;
      font-weight:950;
      text-transform:uppercase;
      letter-spacing:.12px;
      color:var(--muted);
      display:flex;
      align-items:center;
      gap:8px;
    }
    .card-title i{color: var(--primary)}
    .big{ font-size:30px; font-weight:950; margin-top:10px; letter-spacing:-.2px; }
    .sub{ font-size:12px; color:var(--muted2); font-weight:750; margin-top:4px; }

    /* Badges */
    .badge{
      display:inline-flex; align-items:center; gap:8px;
      padding: 6px 10px;
      border-radius: 999px;
      border:1px solid;
      font-weight:950;
      font-size:12px;
      letter-spacing:.1px;
      white-space:nowrap;
    }
    .badge i{font-size:12px}
    .b-good{ background:var(--good-bg); border-color:var(--good-bd); color:var(--good-tx); }
    .b-warn{ background:var(--warn-bg); border-color:var(--warn-bd); color:var(--warn-tx); }
    .b-bad { background:var(--bad-bg);  border-color:var(--bad-bd);  color:var(--bad-tx);  }
    .b-info{ background:var(--info-bg); border-color:var(--info-bd); color:var(--info-tx); }

    /* Buttons */
    .row{ display:flex; gap:10px; flex-wrap: wrap; align-items:center; }
    .btn{
      display:inline-flex; align-items:center; gap:10px;
      padding: 10px 12px;
      border-radius: 12px;
      border:1px solid var(--btnBd);
      background: rgba(255,255,255,.10);
      cursor:pointer;
      font-weight:950;
      color:#93c5fd;
      transition:.2s;
      user-select:none;
    }
    html[data-theme="light"] .btn{
      background: rgba(255,255,255,.7);
      color:#1d4ed8;
    }
    .btn:hover{ background: rgba(37,99,235,.12); }
    .btn:focus-visible{ outline:none; box-shadow:0 0 0 4px var(--ring); }
    .btn-primary{
      border-color: transparent;
      background: linear-gradient(135deg, var(--primary), var(--accent));
      color:#fff;
      box-shadow: 0 10px 18px rgba(37,99,235,.18);
    }

    /* Inputs */
    .input{
      flex: 1 1 260px;
      min-width: 220px;
      display:flex; align-items:center; gap:10px;
      background: rgba(255,255,255,.10);
      border:1px solid var(--cardBd);
      border-radius: 12px;
      padding: 10px 12px;
      box-shadow: var(--shadow-sm);
    }
    html[data-theme="light"] .input{
      background: rgba(255,255,255,.85);
      border-color: rgba(148,163,184,.25);
    }
    .input i{ color: var(--muted2); }
    .input input, .input select{
      border:none; outline:none; background:transparent;
      width:100%;
      color:var(--text);
      font-weight:800;
      font-size:13px;
    }

    /* Table */
    table{
      width:100%;
      border-collapse: collapse;
      background: rgba(255,255,255,.10);
      border:1px solid var(--cardBd);
      border-radius: 14px;
      overflow:hidden;
      box-shadow: var(--shadow-sm);
    }
    html[data-theme="light"] table{
      background: rgba(255,255,255,.85);
      border-color: rgba(148,163,184,.22);
    }
    thead th{
      text-align:left;
      font-size:12px;
      text-transform:uppercase;
      letter-spacing:.12px;
      color:var(--muted);
      padding: 12px 12px;
      background: var(--tableHeadBg);
      border-bottom: 1px solid var(--border);
    }
    tbody td{
      padding: 12px 12px;
      border-bottom: 1px solid rgba(148,163,184,.14);
      font-weight: 800;
      color: var(--text);
      font-size: 13px;
      vertical-align: middle;
    }
    tbody tr:hover{ background: var(--rowHover); }
    tbody tr:last-child td{ border-bottom:none; }

    .clickable{ cursor:pointer; }
    .linklike{ color:#2563eb; font-weight:950; }
    html[data-theme="dark"] .linklike{ color:#93c5fd; }

    /* Charts */
    .chart{ height: 320px; padding: 10px; }
    .chart canvas{ width:100% !important; height:100% !important; }

    /* Toggles (messages) */
    .toggle{
      display:flex; align-items:center; justify-content:space-between;
      padding: 12px;
      border-radius: 14px;
      border:1px solid var(--cardBd);
      background: rgba(255,255,255,.10);
    }
    html[data-theme="light"] .toggle{
      background: rgba(255,255,255,.85);
      border-color: rgba(148,163,184,.22);
    }
    .toggle strong{ font-weight:950; }
    .toggle small{ display:block; color: var(--muted2); font-weight:750; margin-top:2px; }
    .switch{
      width: 46px; height: 26px; border-radius:999px;
      border:1px solid var(--btnBd);
      background: rgba(255,255,255,.10);
      position: relative;
      cursor:pointer;
      flex: 0 0 auto;
    }
    html[data-theme="light"] .switch{ background: rgba(255,255,255,.70); }
    .switch::after{
      content:"";
      width: 20px; height: 20px;
      border-radius:999px;
      background: linear-gradient(135deg, var(--primary), var(--accent));
      position:absolute; top:2px; left:2px;
      transition:.18s;
      box-shadow: 0 6px 10px rgba(37,99,235,.20);
    }
    .switch.on::after{ left: 24px; }
  </style>
</head>

<body>
<header class="header">
  <div class="header-content">
    <div class="logo">
      <div class="logo-icon"><i class="fas fa-heartbeat"></i></div>
      <div class="logo-text">
        <h1>Sant√©+</h1>
        <p data-i18n="app.subtitle">Plateforme de sant√© professionnelle</p>
      </div>
    </div>

    <div class="header-actions">
      <button class="icon-btn" aria-label="Notifications"><i class="fas fa-bell"></i></button>
      <button class="icon-btn" aria-label="Param√®tres"><i class="fas fa-cog"></i></button>
      <button class="icon-btn" aria-label="Profil"><i class="fas fa-user"></i></button>
    </div>
  </div>
</header>

<main class="container">
  <div class="page-header">
    <h2 data-i18n="header.greeting">Bonjour, Dr. Victor Mohammad üëã</h2>
    <p>
      <span data-i18n="header.subline">Dossier m√©dical complet - Mardi 14 Janvier 2026</span>
      <span class="pill"><i class="fas fa-shield-heart"></i> <span data-i18n="header.pill">Mode clinique</span></span>
      <span class="pill"><i class="fas fa-server"></i> <span data-i18n="header.pill2">D√©mo UI</span></span>
    </p>
  </div>

  <div class="tabsbar">
    <div class="tabs" role="tablist" aria-label="Navigation">
      <div class="tab-indicator" id="tabIndicator" aria-hidden="true"></div>

      <button class="tab" role="tab" data-page="dashboard" aria-selected="true" aria-controls="page-dashboard">
        <i class="fas fa-chart-line"></i> <span data-i18n="tabs.dashboard">Dashboard</span>
      </button>

      <button class="tab" role="tab" data-page="patients" aria-selected="false" aria-controls="page-patients">
        <i class="fas fa-user-injured"></i> <span data-i18n="tabs.patients">Patients</span>
      </button>

      <button class="tab" role="tab" data-page="capteurs" aria-selected="false" aria-controls="page-capteurs">
        <i class="fas fa-wave-square"></i> <span data-i18n="tabs.sensors">Capteurs</span>
      </button>

      <button class="tab" role="tab" data-page="rapports" aria-selected="false" aria-controls="page-rapports">
        <i class="fas fa-file-medical"></i> <span data-i18n="tabs.reports">Rapports</span>
      </button>

      <button class="tab" role="tab" data-page="settings" aria-selected="false" aria-controls="page-settings">
        <i class="fas fa-sliders"></i> <span data-i18n="tabs.settings">Param√®tres</span>
      </button>
    </div>

    <div class="hint" data-i18n="hint">Astuce : touches ‚Üê ‚Üí + Enter/Espace ‚Ä¢ URL #page</div>
  </div>

  <!-- DASHBOARD -->
  <section id="page-dashboard" class="page active" role="tabpanel" aria-label="Dashboard">
    <div class="section-head">
      <div>
        <h3 data-i18n="dash.title">Dashboard patient</h3>
        <p data-i18n="dash.subtitle">Vue synth√®se + activit√©. S√©lectionne un patient depuis ‚ÄúPatients‚Äù.</p>
      </div>
      <div class="row">
        <span class="badge b-info"><i class="fas fa-user"></i> <span id="dashPatientName">‚Äî</span></span>
        <button class="btn" type="button" id="btnGoPatients"><i class="fas fa-list"></i> <span data-i18n="dash.back">Liste patients</span></button>
      </div>
    </div>

    <!-- Patient strip -->
    <div class="card" style="margin-bottom:14px">
      <div class="grid-auto">
        <div>
          <div class="card-title"><i class="fas fa-id-card"></i> <span data-i18n="dash.patient">Patient</span></div>
          <div class="big" id="dashPatientFull">‚Äî</div>
          <div class="sub"><span data-i18n="dash.last">Derni√®re mesure</span> : <span id="dashLast">‚Äî</span></div>
        </div>

        <div>
          <div class="card-title"><i class="fas fa-hashtag"></i> ID</div>
          <div class="big" id="dashId">‚Äî</div>
          <div class="sub" data-i18n="dash.internal">Identifiant interne</div>
        </div>

        <div>
          <div class="card-title"><i class="fas fa-birthday-cake"></i> <span data-i18n="dash.age">√Çge</span></div>
          <div class="big"><span id="dashAge">‚Äî</span></div>
          <div class="sub" data-i18n="dash.years">ans</div>
        </div>

        <div>
          <div class="card-title"><i class="fas fa-notes-medical"></i> <span data-i18n="dash.status">Statut</span></div>
          <div class="big" style="font-size:18px;margin-top:12px" id="dashStatus">‚Äî</div>
          <div class="sub" data-i18n="dash.statusSub">Selon la derni√®re mesure</div>
        </div>
      </div>
    </div>

    <!-- KPI cards -->
    <div class="grid-auto">
      <div class="card">
        <div class="card-title"><i class="fas fa-heart"></i> BPM</div>
        <div class="big" id="kpiHr">‚Äî</div>
        <div class="sub" data-i18n="dash.hrSub">bpm ‚Ä¢ derni√®re mesure</div>
      </div>

      <div class="card">
        <div class="card-title"><i class="fas fa-heart-pulse"></i> <span data-i18n="dash.bp">Pression art√©rielle</span></div>
        <div class="big" id="kpiBp">‚Äî</div>
        <div class="sub">mmHg</div>
      </div>

      <div class="card">
        <div class="card-title"><i class="fas fa-wind"></i> SpO‚ÇÇ</div>
        <div class="big" id="kpiSpo2">‚Äî</div>
        <div class="sub" data-i18n="dash.spo2Sub">saturation</div>
      </div>

      <div class="card">
        <div class="card-title"><i class="fas fa-chart-simple"></i> HRV</div>
        <div class="big" id="kpiHrv">‚Äî</div>
        <div class="sub" data-i18n="dash.hrvSub">ms ‚Ä¢ moyenne</div>
      </div>
    </div>

    <!-- Activity & Frequency -->
    <div style="margin-top:14px" class="grid-2">
      <div class="card">
        <div class="section-head" style="margin-bottom:10px">
          <div>
            <h3 style="font-size:16px" data-i18n="dash.activity">Activit√© & Fr√©quence</h3>
            <p style="margin-top:2px" data-i18n="dash.activitySub">BPM (7 jours) ‚Äî tendance hebdomadaire.</p>
          </div>
          <span class="badge b-info"><i class="fas fa-calendar"></i> <span data-i18n="common.week">Semaine</span></span>
        </div>
        <div class="chart"><canvas id="chartHeart"></canvas></div>
      </div>

      <div class="card">
        <div class="section-head" style="margin-bottom:10px">
          <div>
            <h3 style="font-size:16px" data-i18n="dash.bpTrend">√âvolution pression art√©rielle</h3>
            <p style="margin-top:2px" data-i18n="dash.bpTrendSub">Systolique / Diastolique (7 jours).</p>
          </div>
          <span class="badge b-info"><i class="fas fa-chart-line"></i> Graph</span>
        </div>
        <div class="chart"><canvas id="chartBp"></canvas></div>
      </div>
    </div>
  </section>

  <!-- PATIENTS -->
  <section id="page-patients" class="page" role="tabpanel" aria-label="Patients">
    <div class="section-head">
      <div>
        <h3 data-i18n="patients.title">Patients</h3>
        <p data-i18n="patients.subtitle">Recherche, suivi et acc√®s rapide aux dossiers.</p>
      </div>
      <div class="row">
        <button class="btn btn-primary" type="button"><i class="fas fa-user-plus"></i> <span data-i18n="patients.add">Ajouter</span></button>
        <button class="btn" type="button"><i class="fas fa-file-import"></i> <span data-i18n="patients.import">Import</span></button>
      </div>
    </div>

    <div class="row" style="margin-bottom:12px">
      <div class="input" style="flex: 1 1 520px">
        <i class="fas fa-magnifying-glass"></i>
        <input id="searchPatient" placeholder="Rechercher par nom, ID, t√©l√©phone..." />
      </div>

      <div class="input" style="flex: 0 0 220px">
        <i class="fas fa-filter"></i>
        <select id="filterStatus">
          <option value="all" data-i18n="patients.filterAll">Filtre: Tous</option>
          <option value="normal" data-i18n="patients.filterNormal">Normal</option>
          <option value="watch" data-i18n="patients.filterWatch">Suivi</option>
          <option value="planned" data-i18n="patients.filterPlanned">Planifi√©</option>
          <option value="alert" data-i18n="patients.filterAlert">Alerte</option>
        </select>
      </div>

      <div class="input" style="flex: 0 0 220px">
        <i class="fas fa-sort"></i>
        <select id="sortPatients">
          <option value="recent" data-i18n="patients.sortRecent">Trier: r√©cent</option>
          <option value="name" data-i18n="patients.sortName">Nom</option>
          <option value="age" data-i18n="patients.sortAge">√Çge</option>
        </select>
      </div>
    </div>

    <table aria-label="Liste patients">
      <thead>
        <tr>
          <th data-i18n="patients.colPatient">Patient</th>
          <th>ID</th>
          <th data-i18n="patients.colAge">√Çge</th>
          <th data-i18n="patients.colLast">Derni√®re mesure</th>
          <th data-i18n="patients.colStatus">Statut</th>
          <th data-i18n="patients.colAction">Action</th>
        </tr>
      </thead>
      <tbody id="patientsBody"></tbody>
    </table>

    <div class="row" style="justify-content:space-between;margin-top:12px">
      <div class="sub" id="patientsFooter">‚Äî</div>
      <div class="row">
        <button class="btn" type="button"><i class="fas fa-chevron-left"></i> <span data-i18n="common.prev">Pr√©c√©dent</span></button>
        <button class="btn" type="button"><span data-i18n="common.next">Suivant</span> <i class="fas fa-chevron-right"></i></button>
      </div>
    </div>
  </section>

  <!-- CAPTEURS -->
  <section id="page-capteurs" class="page" role="tabpanel" aria-label="Capteurs">
    <div class="section-head">
      <div>
        <h3 data-i18n="sensors.title">Capteurs</h3>
        <p data-i18n="sensors.subtitle">D√©mo temps r√©el (simul√©e). Remplace les valeurs par ton backend plus tard.</p>
      </div>
      <div class="row">
        <span class="badge b-info"><i class="fas fa-microchip"></i> Raspberry Pi 4</span>
        <span class="badge b-info"><i class="fas fa-wave-square"></i> 100‚Äì400 Hz</span>
        <button class="btn btn-primary" type="button" id="btnStartDemo"><i class="fas fa-play"></i> <span data-i18n="common.demo">D√©mo</span></button>
        <button class="btn" type="button" id="btnStopDemo"><i class="fas fa-stop"></i> <span data-i18n="common.stop">Stop</span></button>
      </div>
    </div>

    <div class="grid-auto">
      <div class="card">
        <div class="card-title"><i class="fas fa-heart-pulse"></i> <span data-i18n="sensors.bpNow">Tension actuelle</span></div>
        <div class="big"><span id="bpNow">120/80</span></div>
        <div class="sub"><span data-i18n="sensors.updated">Mis √† jour</span> : <span id="tick">‚Äî</span></div>
        <div style="margin-top:10px"><span class="badge b-good" id="bpStatus"><i class="fas fa-check"></i> Normal</span></div>
      </div>

      <div class="card">
        <div class="card-title"><i class="fas fa-heart"></i> BPM</div>
        <div class="big"><span id="bpmNow">72</span></div>
        <div class="sub" data-i18n="sensors.bpmSub">Mesure instantan√©e (exemple)</div>
      </div>

      <div class="card">
        <div class="card-title"><i class="fas fa-wind"></i> SpO‚ÇÇ</div>
        <div class="big"><span id="spo2Now">98%</span></div>
        <div class="sub" data-i18n="sensors.spo2Sub">Saturation estim√©e</div>
      </div>

      <div class="card">
        <div class="card-title"><i class="fas fa-person-walking"></i> <span data-i18n="sensors.pir">Pr√©sence (PIR)</span></div>
        <div class="big" id="pirNow" data-i18n="sensors.none">Aucune</div>
        <div class="sub" data-i18n="sensors.pirSub">D√©tection mouvement</div>
      </div>
    </div>

    <div style="margin-top:14px" class="grid-2">
      <div class="card">
        <div class="section-head" style="margin-bottom:10px">
          <div>
            <h3 style="font-size:16px" data-i18n="sensors.bpEvolution">√âvolution pression art√©rielle (live)</h3>
            <p style="margin-top:2px" data-i18n="sensors.bpEvolutionSub">D√©mo : points ajout√©s en temps r√©el.</p>
          </div>
          <span class="badge b-info"><i class="fas fa-bolt"></i> Live</span>
        </div>
        <div class="chart"><canvas id="chartBpLive"></canvas></div>
      </div>

      <div class="card">
        <div class="section-head" style="margin-bottom:10px">
          <div>
            <h3 style="font-size:16px" data-i18n="sensors.quality">Qualit√© signal (d√©mo)</h3>
            <p style="margin-top:2px" data-i18n="sensors.qualitySub">Indicateur simple (bon / moyen / faible).</p>
          </div>
          <span class="badge b-info"><i class="fas fa-signal"></i> Signal</span>
        </div>
        <div class="grid-auto">
          <div class="card">
            <div class="card-title"><i class="fas fa-circle-check"></i> <span data-i18n="sensors.placement">Placement capteur</span></div>
            <div class="big" id="sigPlacement">Bon</div>
            <div class="sub" data-i18n="sensors.placementSub">Bas√© sur la stabilit√© (exemple)</div>
          </div>
          <div class="card">
            <div class="card-title"><i class="fas fa-wave-square"></i> <span data-i18n="sensors.sampling">√âchantillonnage</span></div>
            <div class="big">400 Hz</div>
            <div class="sub" data-i18n="sensors.samplingSub">Mode haute pr√©cision</div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- RAPPORTS -->
  <section id="page-rapports" class="page" role="tabpanel" aria-label="Rapports">
    <div class="section-head">
      <div>
        <h3 data-i18n="reports.title">Rapports & Historique</h3>
        <p data-i18n="reports.subtitle">Export, suivi et consultation des dossiers (exemples).</p>
      </div>
      <div class="row">
        <button class="btn btn-primary" type="button"><i class="fas fa-file-arrow-down"></i> <span data-i18n="reports.export">Exporter</span></button>
        <button class="btn" type="button"><i class="fas fa-print"></i> <span data-i18n="reports.print">Imprimer</span></button>
      </div>
    </div>

    <div class="grid-3">
      <div class="card">
        <div class="card-title"><i class="fas fa-user"></i> Waly</div>
        <div class="sub" data-i18n="reports.last">Derni√®re mesure</div>
        <div class="big" style="font-size:22px;margin-top:10px">121/79 ‚Ä¢ 74 bpm</div>
        <div class="sub">SpO‚ÇÇ 98% ‚Ä¢ 14/01/2026 08:30</div>
        <div class="row" style="margin-top:12px">
          <span class="badge b-good"><i class="fas fa-check"></i> Normal</span>
          <button class="btn" type="button"><i class="fas fa-folder-open"></i> <span data-i18n="reports.open">Ouvrir</span></button>
        </div>
      </div>

      <div class="card">
        <div class="card-title"><i class="fas fa-user"></i> Binaf</div>
        <div class="sub" data-i18n="reports.last">Derni√®re mesure</div>
        <div class="big" style="font-size:22px;margin-top:10px">135/86 ‚Ä¢ 88 bpm</div>
        <div class="sub">SpO‚ÇÇ 96% ‚Ä¢ 13/01/2026 17:10</div>
        <div class="row" style="margin-top:12px">
          <span class="badge b-warn"><i class="fas fa-triangle-exclamation"></i> √Ä surveiller</span>
          <button class="btn" type="button"><i class="fas fa-folder-open"></i> <span data-i18n="reports.open">Ouvrir</span></button>
        </div>
      </div>

      <div class="card">
        <div class="card-title"><i class="fas fa-user"></i> Messaoud</div>
        <div class="sub" data-i18n="reports.last">Derni√®re mesure</div>
        <div class="big" style="font-size:22px;margin-top:10px">118/76 ‚Ä¢ 69 bpm</div>
        <div class="sub">SpO‚ÇÇ 99% ‚Ä¢ 12/01/2026 09:05</div>
        <div class="row" style="margin-top:12px">
          <span class="badge b-good"><i class="fas fa-check"></i> Normal</span>
          <button class="btn" type="button"><i class="fas fa-folder-open"></i> <span data-i18n="reports.open">Ouvrir</span></button>
        </div>
      </div>
    </div>

    <div class="card" style="margin-top:14px">
      <div class="section-head" style="margin-bottom:10px">
        <div>
          <h3 style="font-size:16px" data-i18n="reports.tableTitle">Journal des mesures</h3>
          <p style="margin-top:2px" data-i18n="reports.tableSub">Aper√ßu multi-patients.</p>
        </div>
        <span class="badge b-info"><i class="fas fa-clock"></i> <span data-i18n="common.days7">7 jours</span></span>
      </div>

      <table aria-label="Historique patients">
        <thead>
          <tr>
            <th data-i18n="history.patient">Patient</th>
            <th data-i18n="history.date">Date</th>
            <th>BPM</th>
            <th data-i18n="history.bp">Pression</th>
            <th>SpO‚ÇÇ</th>
            <th data-i18n="history.status">Statut</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Waly</td><td>14/01/2026 ‚Ä¢ 08:30</td><td>74</td><td>121/79</td><td>98%</td>
            <td><span class="badge b-good"><i class="fas fa-check"></i> Normal</span></td>
          </tr>
          <tr>
            <td>Binaf</td><td>13/01/2026 ‚Ä¢ 17:10</td><td>88</td><td>135/86</td><td>96%</td>
            <td><span class="badge b-warn"><i class="fas fa-triangle-exclamation"></i> Suivi</span></td>
          </tr>
          <tr>
            <td>Messaoud</td><td>12/01/2026 ‚Ä¢ 09:05</td><td>69</td><td>118/76</td><td>99%</td>
            <td><span class="badge b-good"><i class="fas fa-check"></i> Normal</span></td>
          </tr>
          <tr>
            <td>Rachid Benali</td><td>11/01/2026 ‚Ä¢ 15:22</td><td>92</td><td>142/90</td><td>95%</td>
            <td><span class="badge b-bad"><i class="fas fa-bell"></i> Alerte</span></td>
          </tr>
        </tbody>
      </table>
    </div>
  </section>

  <!-- SETTINGS -->
  <section id="page-settings" class="page" role="tabpanel" aria-label="Param√®tres">
    <div class="section-head">
      <div>
        <h3 data-i18n="settings.title">Param√®tres</h3>
        <p data-i18n="settings.subtitle">Th√®me, langue et messages patient (fonctionnels).</p>
      </div>
      <div class="row">
        <span class="badge b-info"><i class="fas fa-floppy-disk"></i> <span data-i18n="settings.autosave">Sauvegarde auto</span></span>
      </div>
    </div>

    <div class="grid-2">
      <div class="card">
        <div class="section-head" style="margin-bottom:10px">
          <div>
            <h3 style="font-size:16px" data-i18n="prefs.title">Pr√©f√©rences</h3>
            <p style="margin-top:2px" data-i18n="prefs.subtitle">Appliqu√©es imm√©diatement (et m√©moris√©es).</p>
          </div>
        </div>

        <div class="row">
          <div class="input" style="flex:1 1 260px">
            <i class="fas fa-palette"></i>
            <select id="themeSelect" aria-label="Th√®me">
              <option value="light" data-i18n="prefs.themeLight">Th√®me : Clair</option>
              <option value="dark" data-i18n="prefs.themeDark">Th√®me : Sombre</option>
            </select>
          </div>

          <div class="input" style="flex:1 1 260px">
            <i class="fas fa-language"></i>
            <select id="langSelect" aria-label="Langue">
              <option value="fr">Langue : Fran√ßais</option>
              <option value="en">Language : English</option>
            </select>
          </div>
        </div>

        <div class="card" style="margin-top:12px">
          <div class="card-title"><i class="fas fa-circle-info"></i> <span data-i18n="settings.note">Note</span></div>
          <div class="sub" data-i18n="settings.noteBody">
            Le th√®me et la langue sont stock√©s en local (localStorage) pour rester apr√®s rechargement.
          </div>
        </div>
      </div>

      <div class="card">
        <div class="section-head" style="margin-bottom:10px">
          <div>
            <h3 style="font-size:16px" data-i18n="msg.title">Messages patient</h3>
            <p style="margin-top:2px" data-i18n="msg.subtitle">Active/d√©sactive les messages automatiques + aper√ßu.</p>
          </div>
          <button class="btn btn-primary" type="button" id="btnPreviewMsg"><i class="fas fa-eye"></i> <span data-i18n="msg.preview">Aper√ßu</span></button>
        </div>

        <div class="grid-auto">
          <div class="toggle">
            <div>
              <strong data-i18n="msg.m1">Mesure normale</strong>
              <small data-i18n="msg.m1s">Envoyer un message rassurant si tout est OK.</small>
            </div>
            <div class="switch on" data-key="m1"></div>
          </div>

          <div class="toggle">
            <div>
              <strong data-i18n="msg.m2">√Ä surveiller</strong>
              <small data-i18n="msg.m2s">Demander une nouvelle mesure au repos.</small>
            </div>
            <div class="switch on" data-key="m2"></div>
          </div>

          <div class="toggle">
            <div>
              <strong data-i18n="msg.m3">Alerte critique</strong>
              <small data-i18n="msg.m3s">D√©clencher un message urgent (et/ou appel).</small>
            </div>
            <div class="switch on" data-key="m3"></div>
          </div>

          <div class="toggle">
            <div>
              <strong data-i18n="msg.m4">Capteur mal positionn√©</strong>
              <small data-i18n="msg.m4s">Conseiller de repositionner le capteur (MAX30102).</small>
            </div>
            <div class="switch on" data-key="m4"></div>
          </div>
        </div>

        <div class="card" style="margin-top:12px">
          <div class="card-title"><i class="fas fa-message"></i> <span data-i18n="msg.sample">Exemple</span></div>
          <div class="sub" id="msgSample">
            Bonjour, vos mesures sont normales. Continuez vos habitudes.
          </div>
        </div>
      </div>
    </div>
  </section>
</main>

<script>
  // =========================
  // DATA MODEL (DEMO)
  // =========================
  const patients = [
    {
      id: "83947",
      name: "Marie Dubois",
      age: 42,
      last: "14/01/2026 ‚Ä¢ 08:30",
      status: "normal",
      hr: 72,
      spo2: 98,
      hrv: 58,
      bp: { sys: 120, dia: 80 },
      bpm7: [68,72,70,75,71,73,72],
      bp7: {
        labels: ["Lun","Mar","Mer","Jeu","Ven","Sam","Dim"],
        sys: [118,122,120,119,120,121,120],
        dia: [78,82,80,79,80,80,79]
      }
    },
    {
      id: "12058",
      name: "Rachid Benali",
      age: 57,
      last: "13/01/2026 ‚Ä¢ 17:05",
      status: "watch",
      hr: 88,
      spo2: 96,
      hrv: 42,
      bp: { sys: 135, dia: 86 },
      bpm7: [80,84,86,90,85,88,87],
      bp7: {
        labels: ["Lun","Mar","Mer","Jeu","Ven","Sam","Dim"],
        sys: [128,132,135,134,136,138,135],
        dia: [82,84,86,85,86,87,86]
      }
    },
    {
      id: "77412",
      name: "Camille Laurent",
      age: 34,
      last: "12/01/2026 ‚Ä¢ 09:10",
      status: "planned",
      hr: 70,
      spo2: 99,
      hrv: 64,
      bp: { sys: 118, dia: 76 },
      bpm7: [66,68,70,69,71,70,70],
      bp7: {
        labels: ["Lun","Mar","Mer","Jeu","Ven","Sam","Dim"],
        sys: [116,118,119,117,118,118,117],
        dia: [75,76,77,76,76,76,75]
      }
    },
    {
      id: "44590",
      name: "Jean Martin",
      age: 66,
      last: "11/01/2026 ‚Ä¢ 15:22",
      status: "alert",
      hr: 92,
      spo2: 95,
      hrv: 31,
      bp: { sys: 142, dia: 90 },
      bpm7: [86,90,92,94,95,93,92],
      bp7: {
        labels: ["Lun","Mar","Mer","Jeu","Ven","Sam","Dim"],
        sys: [138,140,142,143,144,143,142],
        dia: [88,89,90,91,90,90,90]
      }
    }
  ];

  // =========================
  // I18N minimal (FR/EN)
  // =========================
  const I18N = {
    fr: {
      "app.subtitle":"Plateforme de sant√© professionnelle",
      "header.greeting":"Bonjour, Dr. Victor Mohammad üëã",
      "header.subline":"Dossier m√©dical complet - Mardi 14 Janvier 2026",
      "header.pill":"Mode clinique",
      "header.pill2":"D√©mo UI",

      "tabs.dashboard":"Dashboard",
      "tabs.patients":"Patients",
      "tabs.sensors":"Capteurs",
      "tabs.reports":"Rapports",
      "tabs.settings":"Param√®tres",

      "hint":"Astuce : touches ‚Üê ‚Üí + Enter/Espace ‚Ä¢ URL #page",

      "dash.title":"Dashboard patient",
      "dash.subtitle":"Vue synth√®se + activit√©. S√©lectionne un patient depuis ‚ÄúPatients‚Äù.",
      "dash.back":"Liste patients",
      "dash.patient":"Patient",
      "dash.last":"Derni√®re mesure",
      "dash.internal":"Identifiant interne",
      "dash.age":"√Çge",
      "dash.years":"ans",
      "dash.status":"Statut",
      "dash.statusSub":"Selon la derni√®re mesure",
      "dash.hrSub":"bpm ‚Ä¢ derni√®re mesure",
      "dash.bp":"Pression art√©rielle",
      "dash.spo2Sub":"saturation",
      "dash.hrvSub":"ms ‚Ä¢ moyenne",
      "dash.activity":"Activit√© & Fr√©quence",
      "dash.activitySub":"BPM (7 jours) ‚Äî tendance hebdomadaire.",
      "dash.bpTrend":"√âvolution pression art√©rielle",
      "dash.bpTrendSub":"Systolique / Diastolique (7 jours).",

      "patients.title":"Patients",
      "patients.subtitle":"Recherche, suivi et acc√®s rapide aux dossiers.",
      "patients.add":"Ajouter",
      "patients.import":"Import",
      "patients.colPatient":"Patient",
      "patients.colAge":"√Çge",
      "patients.colLast":"Derni√®re mesure",
      "patients.colStatus":"Statut",
      "patients.colAction":"Action",
      "patients.filterAll":"Filtre: Tous",
      "patients.filterNormal":"Normal",
      "patients.filterWatch":"Suivi",
      "patients.filterPlanned":"Planifi√©",
      "patients.filterAlert":"Alerte",
      "patients.sortRecent":"Trier: r√©cent",
      "patients.sortName":"Nom",
      "patients.sortAge":"√Çge",
      "patients.open":"Ouvrir",

      "sensors.title":"Capteurs",
      "sensors.subtitle":"D√©mo temps r√©el (simul√©e). Remplace les valeurs par ton backend plus tard.",
      "sensors.bpNow":"Tension actuelle",
      "sensors.updated":"Mis √† jour",
      "sensors.bpmSub":"Mesure instantan√©e (exemple)",
      "sensors.spo2Sub":"Saturation estim√©e",
      "sensors.pir":"Pr√©sence (PIR)",
      "sensors.none":"Aucune",
      "sensors.pirSub":"D√©tection mouvement",
      "sensors.bpEvolution":"√âvolution pression art√©rielle (live)",
      "sensors.bpEvolutionSub":"D√©mo : points ajout√©s en temps r√©el.",
      "sensors.quality":"Qualit√© signal (d√©mo)",
      "sensors.qualitySub":"Indicateur simple (bon / moyen / faible).",
      "sensors.placement":"Placement capteur",
      "sensors.placementSub":"Bas√© sur la stabilit√© (exemple)",
      "sensors.sampling":"√âchantillonnage",
      "sensors.samplingSub":"Mode haute pr√©cision",

      "reports.title":"Rapports & Historique",
      "reports.subtitle":"Export, suivi et consultation des dossiers (exemples).",
      "reports.export":"Exporter",
      "reports.print":"Imprimer",
      "reports.last":"Derni√®re mesure",
      "reports.open":"Ouvrir",
      "reports.tableTitle":"Journal des mesures",
      "reports.tableSub":"Aper√ßu multi-patients.",

      "history.patient":"Patient",
      "history.date":"Date",
      "history.bp":"Pression",
      "history.status":"Statut",

      "settings.title":"Param√®tres",
      "settings.subtitle":"Th√®me, langue et messages patient (fonctionnels).",
      "settings.autosave":"Sauvegarde auto",
      "settings.note":"Note",
      "settings.noteBody":"Le th√®me et la langue sont stock√©s en local (localStorage) pour rester apr√®s rechargement.",

      "prefs.title":"Pr√©f√©rences",
      "prefs.subtitle":"Appliqu√©es imm√©diatement (et m√©moris√©es).",
      "prefs.themeLight":"Th√®me : Clair",
      "prefs.themeDark":"Th√®me : Sombre",

      "msg.title":"Messages patient",
      "msg.subtitle":"Active/d√©sactive les messages automatiques + aper√ßu.",
      "msg.preview":"Aper√ßu",
      "msg.m1":"Mesure normale",
      "msg.m1s":"Envoyer un message rassurant si tout est OK.",
      "msg.m2":"√Ä surveiller",
      "msg.m2s":"Demander une nouvelle mesure au repos.",
      "msg.m3":"Alerte critique",
      "msg.m3s":"D√©clencher un message urgent (et/ou appel).",
      "msg.m4":"Capteur mal positionn√©",
      "msg.m4s":"Conseiller de repositionner le capteur (MAX30102).",
      "msg.sample":"Exemple",

      "common.week":"Semaine",
      "common.days7":"7 jours",
      "common.demo":"D√©mo",
      "common.stop":"Stop",
      "common.prev":"Pr√©c√©dent",
      "common.next":"Suivant",

      "status.normal":"Normal",
      "status.watch":"Suivi",
      "status.planned":"Planifi√©",
      "status.alert":"Alerte"
    },

    en: {
      "app.subtitle":"Professional health platform",
      "header.greeting":"Hello, Dr. Victor Mohammad üëã",
      "header.subline":"Full medical record - Tuesday, Jan 14, 2026",
      "header.pill":"Clinical mode",
      "header.pill2":"UI demo",

      "tabs.dashboard":"Dashboard",
      "tabs.patients":"Patients",
      "tabs.sensors":"Sensors",
      "tabs.reports":"Reports",
      "tabs.settings":"Settings",

      "hint":"Tip: use ‚Üê ‚Üí + Enter/Space ‚Ä¢ URL #page",

      "dash.title":"Patient dashboard",
      "dash.subtitle":"Summary + activity. Select a patient from ‚ÄúPatients‚Äù.",
      "dash.back":"Patient list",
      "dash.patient":"Patient",
      "dash.last":"Last reading",
      "dash.internal":"Internal ID",
      "dash.age":"Age",
      "dash.years":"years",
      "dash.status":"Status",
      "dash.statusSub":"Based on last reading",
      "dash.hrSub":"bpm ‚Ä¢ last reading",
      "dash.bp":"Blood pressure",
      "dash.spo2Sub":"saturation",
      "dash.hrvSub":"ms ‚Ä¢ average",
      "dash.activity":"Activity & Heart Rate",
      "dash.activitySub":"BPM (7 days) ‚Äî weekly trend.",
      "dash.bpTrend":"Blood pressure trend",
      "dash.bpTrendSub":"Systolic / Diastolic (7 days).",

      "patients.title":"Patients",
      "patients.subtitle":"Search, follow-up, quick access to records.",
      "patients.add":"Add",
      "patients.import":"Import",
      "patients.colPatient":"Patient",
      "patients.colAge":"Age",
      "patients.colLast":"Last reading",
      "patients.colStatus":"Status",
      "patients.colAction":"Action",
      "patients.filterAll":"Filter: All",
      "patients.filterNormal":"Normal",
      "patients.filterWatch":"Watch",
      "patients.filterPlanned":"Planned",
      "patients.filterAlert":"Alert",
      "patients.sortRecent":"Sort: recent",
      "patients.sortName":"Name",
      "patients.sortAge":"Age",
      "patients.open":"Open",

      "sensors.title":"Sensors",
      "sensors.subtitle":"Real-time demo (simulated). Replace values with your backend later.",
      "sensors.bpNow":"Current BP",
      "sensors.updated":"Updated",
      "sensors.bpmSub":"Instant reading (example)",
      "sensors.spo2Sub":"Estimated saturation",
      "sensors.pir":"Presence (PIR)",
      "sensors.none":"None",
      "sensors.pirSub":"Motion detection",
      "sensors.bpEvolution":"Blood pressure evolution (live)",
      "sensors.bpEvolutionSub":"Demo: points added in real time.",
      "sensors.quality":"Signal quality (demo)",
      "sensors.qualitySub":"Simple indicator (good / medium / low).",
      "sensors.placement":"Sensor placement",
      "sensors.placementSub":"Based on stability (example)",
      "sensors.sampling":"Sampling",
      "sensors.samplingSub":"High precision mode",

      "reports.title":"Reports & History",
      "reports.subtitle":"Export, follow-up and record review (examples).",
      "reports.export":"Export",
      "reports.print":"Print",
      "reports.last":"Last reading",
      "reports.open":"Open",
      "reports.tableTitle":"Readings log",
      "reports.tableSub":"Multi-patient overview.",

      "history.patient":"Patient",
      "history.date":"Date",
      "history.bp":"BP",
      "history.status":"Status",

      "settings.title":"Settings",
      "settings.subtitle":"Theme, language and patient messages (working).",
      "settings.autosave":"Auto-save",
      "settings.note":"Note",
      "settings.noteBody":"Theme and language are stored locally (localStorage) to persist after reload.",

      "prefs.title":"Preferences",
      "prefs.subtitle":"Applied instantly (and saved).",
      "prefs.themeLight":"Theme: Light",
      "prefs.themeDark":"Theme: Dark",

      "msg.title":"Patient messages",
      "msg.subtitle":"Enable/disable automatic messages + preview.",
      "msg.preview":"Preview",
      "msg.m1":"Normal reading",
      "msg.m1s":"Send a reassuring message if everything is OK.",
      "msg.m2":"Needs attention",
      "msg.m2s":"Ask for a new reading at rest.",
      "msg.m3":"Critical alert",
      "msg.m3s":"Trigger an urgent message (and/or call).",
      "msg.m4":"Sensor misplaced",
      "msg.m4s":"Advise repositioning the sensor (MAX30102).",
      "msg.sample":"Example",

      "common.week":"Week",
      "common.days7":"7 days",
      "common.demo":"Demo",
      "common.stop":"Stop",
      "common.prev":"Prev",
      "common.next":"Next",

      "status.normal":"Normal",
      "status.watch":"Watch",
      "status.planned":"Planned",
      "status.alert":"Alert"
    }
  };

  function applyI18n(lang){
    const dict = I18N[lang] || I18N.fr;
    document.querySelectorAll("[data-i18n]").forEach(el=>{
      const key = el.getAttribute("data-i18n");
      if (dict[key]) el.innerHTML = dict[key];
    });

    // Update theme option labels
    document.querySelectorAll("#themeSelect option[data-i18n]").forEach(opt=>{
      const key = opt.getAttribute("data-i18n");
      if (dict[key]) opt.textContent = dict[key];
    });

    // Refresh table badges/buttons language
    renderPatientsTable();

    // Refresh message sample
    updateMessageSample();
  }

  // =========================
  // THEME + LANG persistence
  // =========================
  const THEME_KEY="sante_theme";
  const LANG_KEY="sante_lang";

  function setTheme(theme){
    document.documentElement.setAttribute("data-theme", theme);
    localStorage.setItem(THEME_KEY, theme);
    document.getElementById("themeSelect").value = theme;
    rebuildCharts();
  }

  function setLang(lang){
    document.documentElement.lang = lang;
    localStorage.setItem(LANG_KEY, lang);
    document.getElementById("langSelect").value = lang;
    applyI18n(lang);
    rebuildCharts();
  }

  // =========================
  // NAVIGATION
  // =========================
  const tabs = Array.from(document.querySelectorAll(".tab"));
  const pages = Array.from(document.querySelectorAll(".page"));
  const indicator = document.getElementById("tabIndicator");

  function getActiveTab(){
    return tabs.find(t=>t.getAttribute("aria-selected")==="true") || tabs[0];
  }

  function moveIndicatorTo(tabEl){
    const wrap = tabEl.parentElement;
    const tabRect = tabEl.getBoundingClientRect();
    const wrapRect = wrap.getBoundingClientRect();
    const left = tabRect.left - wrapRect.left;
    indicator.style.width = tabRect.width + "px";
    indicator.style.transform = "translateX(" + left + "px)";
  }

  function setActivePage(pageName, pushHash=true){
    pages.forEach(p=>p.classList.toggle("active", p.id === "page-"+pageName));
    tabs.forEach(t=>{
      const on = (t.dataset.page === pageName);
      t.setAttribute("aria-selected", on ? "true" : "false");
    });
    const activeTab = tabs.find(t=>t.dataset.page===pageName);
    if (activeTab) moveIndicatorTo(activeTab);
    if (pushHash) history.replaceState(null,"","#"+pageName);
  }

  tabs.forEach(t=>{
    t.addEventListener("click", ()=> setActivePage(t.dataset.page));
    t.addEventListener("keydown", (e)=>{
      if (e.key==="Enter" || e.key===" "){
        e.preventDefault();
        setActivePage(t.dataset.page);
      }
    });
  });

  document.addEventListener("keydown", (e)=>{
    if (e.key!=="ArrowLeft" && e.key!=="ArrowRight") return;
    const current = tabs.findIndex(t=>t.getAttribute("aria-selected")==="true");
    if (current<0) return;
    const next = (e.key==="ArrowRight") ? (current+1)%tabs.length : (current-1+tabs.length)%tabs.length;
    tabs[next].focus();
    setActivePage(tabs[next].dataset.page);
  });

  function initNav(){
    const initial = (location.hash || "#dashboard").replace("#","");
    const exists = pages.some(p=>p.id==="page-"+initial);
    setActivePage(exists ? initial : "dashboard", false);
    requestAnimationFrame(()=>moveIndicatorTo(getActiveTab()));
    window.addEventListener("resize", ()=>moveIndicatorTo(getActiveTab()));
  }

  // =========================
  // STATUS helpers
  // =========================
  function statusBadgeHTML(status){
    const lang = document.documentElement.lang || "fr";
    const dict = I18N[lang] || I18N.fr;

    if (status === "normal") return `<span class="badge b-good"><i class="fas fa-check"></i> ${dict["status.normal"]}</span>`;
    if (status === "watch")  return `<span class="badge b-warn"><i class="fas fa-triangle-exclamation"></i> ${dict["status.watch"]}</span>`;
    if (status === "planned")return `<span class="badge b-info"><i class="fas fa-calendar"></i> ${dict["status.planned"]}</span>`;
    return `<span class="badge b-bad"><i class="fas fa-bell"></i> ${dict["status.alert"]}</span>`;
  }

  // =========================
  // PATIENT selection + dashboard binding
  // =========================
  const SELECTED_KEY = "sante_selected_patient_id";
  let selectedPatient = null;

  function loadPatientById(id){
    const p = patients.find(x=>x.id===id) || patients[0];
    selectedPatient = p;
    localStorage.setItem(SELECTED_KEY, p.id);

    document.getElementById("dashPatientName").textContent = p.name;
    document.getElementById("dashPatientFull").textContent = p.name;
    document.getElementById("dashId").textContent = p.id;
    document.getElementById("dashAge").textContent = p.age;
    document.getElementById("dashLast").textContent = p.last;
    document.getElementById("dashStatus").innerHTML = statusBadgeHTML(p.status);

    document.getElementById("kpiHr").textContent = p.hr;
    document.getElementById("kpiBp").textContent = `${p.bp.sys}/${p.bp.dia}`;
    document.getElementById("kpiSpo2").textContent = `${p.spo2}%`;
    document.getElementById("kpiHrv").textContent = `${p.hrv}`;

    rebuildCharts();
  }

  function openPatientDashboard(id){
    loadPatientById(id);
    setActivePage("dashboard");
  }

  // =========================
  // PATIENTS TABLE
  // =========================
  function renderPatientsTable(){
    const tbody = document.getElementById("patientsBody");
    if (!tbody) return;

    const q = (document.getElementById("searchPatient").value || "").trim().toLowerCase();
    const f = document.getElementById("filterStatus").value;
    const s = document.getElementById("sortPatients").value;

    let data = patients.slice();

    if (f !== "all") data = data.filter(p => p.status === f);

    if (q){
      data = data.filter(p =>
        p.name.toLowerCase().includes(q) ||
        p.id.toLowerCase().includes(q)
      );
    }

    if (s === "name") data.sort((a,b)=> a.name.localeCompare(b.name));
    if (s === "age") data.sort((a,b)=> a.age - b.age);

    const lang = document.documentElement.lang || "fr";
    const dict = I18N[lang] || I18N.fr;

    tbody.innerHTML = data.map(p=>{
      return `
        <tr class="clickable" data-patient-id="${p.id}">
          <td><span class="linklike">${p.name}</span></td>
          <td>${p.id}</td>
          <td>${p.age}</td>
          <td>${p.last}</td>
          <td>${statusBadgeHTML(p.status)}</td>
          <td>
            <button class="btn btn-primary" type="button" data-open-id="${p.id}">
              <i class="fas fa-folder-open"></i> ${dict["patients.open"]}
            </button>
          </td>
        </tr>
      `;
    }).join("");

    document.getElementById("patientsFooter").textContent =
      (lang==="en")
        ? `Showing: ${data.length} patients ‚Ä¢ Page 1/1`
        : `Affichage: ${data.length} patients ‚Ä¢ Page 1/1`;

    // Row click
    tbody.querySelectorAll("tr[data-patient-id]").forEach(tr=>{
      tr.addEventListener("click", ()=>{
        openPatientDashboard(tr.getAttribute("data-patient-id"));
      });
    });

    // Button click
    tbody.querySelectorAll("button[data-open-id]").forEach(btn=>{
      btn.addEventListener("click", (e)=>{
        e.stopPropagation();
        openPatientDashboard(btn.getAttribute("data-open-id"));
      });
    });
  }

  // =========================
  // CHARTS (Dashboard)
  // =========================
  let chartHeart = null;
  let chartBp = null;

  function rebuildCharts(){
    if (!selectedPatient) return;

    if (chartHeart) chartHeart.destroy();
    if (chartBp) chartBp.destroy();

    // Heart chart
    const ctxH = document.getElementById("chartHeart").getContext("2d");
    chartHeart = new Chart(ctxH, {
      type: "line",
      data: {
        labels: selectedPatient.bp7.labels,
        datasets: [{
          label: "BPM",
          data: selectedPatient.bpm7,
          borderColor: "#dc2626",
          backgroundColor: "rgba(220,38,38,.08)",
          fill: true,
          tension: .35,
          borderWidth: 2,
          pointRadius: 3
        }]
      },
      options: {
        responsive:true,
        maintainAspectRatio:false,
        plugins:{ legend:{ display:false } }
      }
    });

    // BP chart
    const ctxB = document.getElementById("chartBp").getContext("2d");
    const lang = document.documentElement.lang || "fr";
    chartBp = new Chart(ctxB, {
      type: "line",
      data: {
        labels: selectedPatient.bp7.labels,
        datasets: [
          {
            label: (lang==="en") ? "Systolic" : "Systolique",
            data: selectedPatient.bp7.sys,
            borderColor:"#dc2626",
            backgroundColor:"rgba(220,38,38,.06)",
            fill:true,
            tension:.35,
            borderWidth:2,
            pointRadius:3
          },
          {
            label: (lang==="en") ? "Diastolic" : "Diastolique",
            data: selectedPatient.bp7.dia,
            borderColor:"#2563eb",
            backgroundColor:"rgba(37,99,235,.06)",
            fill:true,
            tension:.35,
            borderWidth:2,
            pointRadius:3
          }
        ]
      },
      options:{
        responsive:true,
        maintainAspectRatio:false,
        plugins:{ legend:{ display:true, position:"bottom" } }
      }
    });

    // Live BP chart also depends on theme; update if exists
    rebuildBpLiveIfNeeded();
  }

  // =========================
  // CAPTEURS LIVE (demo)
  // =========================
  let demoTimer=null;
  let t=0;

  let bpLiveChart=null;
  const bpLiveMaxPoints = 18;
  let bpLiveData = { labels: [], sys: [], dia: [] };

  function rebuildBpLiveIfNeeded(){
    const canvas = document.getElementById("chartBpLive");
    if (!canvas) return;

    if (bpLiveChart) bpLiveChart.destroy();

    const ctx = canvas.getContext("2d");
    const lang = document.documentElement.lang || "fr";

    bpLiveChart = new Chart(ctx, {
      type: "line",
      data: {
        labels: bpLiveData.labels,
        datasets: [
          {
            label: (lang==="en") ? "Systolic (live)" : "Systolique (live)",
            data: bpLiveData.sys,
            borderColor:"#dc2626",
            backgroundColor:"rgba(220,38,38,.06)",
            fill:true,
            tension:.35,
            borderWidth:2,
            pointRadius:2
          },
          {
            label: (lang==="en") ? "Diastolic (live)" : "Diastolique (live)",
            data: bpLiveData.dia,
            borderColor:"#2563eb",
            backgroundColor:"rgba(37,99,235,.06)",
            fill:true,
            tension:.35,
            borderWidth:2,
            pointRadius:2
          }
        ]
      },
      options:{
        responsive:true,
        maintainAspectRatio:false,
        plugins:{ legend:{ display:true, position:"bottom" } },
        animation: false
      }
    });
  }

  function pushLiveBP(sys, dia){
    const now = new Date();
    const hh = String(now.getHours()).padStart(2,"0");
    const mm = String(now.getMinutes()).padStart(2,"0");
    const ss = String(now.getSeconds()).padStart(2,"0");
    const label = `${hh}:${mm}:${ss}`;

    bpLiveData.labels.push(label);
    bpLiveData.sys.push(sys);
    bpLiveData.dia.push(dia);

    if (bpLiveData.labels.length > bpLiveMaxPoints){
      bpLiveData.labels.shift();
      bpLiveData.sys.shift();
      bpLiveData.dia.shift();
    }

    if (bpLiveChart){
      bpLiveChart.data.labels = bpLiveData.labels;
      bpLiveChart.data.datasets[0].data = bpLiveData.sys;
      bpLiveChart.data.datasets[1].data = bpLiveData.dia;
      bpLiveChart.update("none");
    }
  }

  function startDemo(){
    stopDemo();
    // init live chart if needed
    if (!bpLiveChart) rebuildBpLiveIfNeeded();

    demoTimer=setInterval(()=>{
      t++;

      const bpm = Math.round(72 + 10*Math.sin(t/6) + 2*Math.sin(t/2.2));
      document.getElementById("bpmNow").textContent=bpm;

      const spo2 = Math.max(92, Math.min(100, Math.round(97 + 2*Math.sin(t/9) + (Math.random()-0.5))));
      document.getElementById("spo2Now").textContent = `${spo2}%`;

      const sys = Math.round(120 + 10*Math.sin(t/9) + 3*Math.sin(t/3.8));
      const dia = Math.round(80 + 7*Math.sin(t/10) + 2*Math.sin(t/4.1));
      document.getElementById("bpNow").textContent = `${sys}/${dia}`;

      const now=new Date();
      const hh=String(now.getHours()).padStart(2,"0");
      const mm=String(now.getMinutes()).padStart(2,"0");
      const ss=String(now.getSeconds()).padStart(2,"0");
      document.getElementById("tick").textContent = `${hh}:${mm}:${ss}`;

      // BP status badge
      const bpStatus=document.getElementById("bpStatus");
      const lang = document.documentElement.lang || "fr";
      const dict = I18N[lang] || I18N.fr;

      if (sys>=140 || dia>=90){
        bpStatus.className = "badge b-bad";
        bpStatus.innerHTML = `<i class="fas fa-bell"></i> ${dict["status.alert"]}`;
      } else if (sys>=130 || dia>=85){
        bpStatus.className = "badge b-warn";
        bpStatus.innerHTML = `<i class="fas fa-triangle-exclamation"></i> ${dict["status.watch"]}`;
      } else {
        bpStatus.className = "badge b-good";
        bpStatus.innerHTML = `<i class="fas fa-check"></i> ${dict["status.normal"]}`;
      }

      // PIR
      const pir = (Math.random()<0.10)
        ? ((lang==="en") ? "Motion detected" : "Mouvement d√©tect√©")
        : ((lang==="en") ? "None" : "Aucune");
      document.getElementById("pirNow").textContent = pir;

      // Signal quality demo
      const placement = (Math.random()<0.78) ? ((lang==="en") ? "Good" : "Bon")
                     : (Math.random()<0.6)  ? ((lang==="en") ? "Medium" : "Moyen")
                                            : ((lang==="en") ? "Low" : "Faible");
      document.getElementById("sigPlacement").textContent = placement;

      // Push live BP point
      pushLiveBP(sys, dia);

    }, 700);
  }

  function stopDemo(){
    if (demoTimer) clearInterval(demoTimer);
    demoTimer=null;
  }

  // =========================
  // SETTINGS: message toggles + preview
  // =========================
  const MSG_KEY = "sante_msg_flags";
  let msgFlags = { m1:true, m2:true, m3:true, m4:true };

  function loadMsgFlags(){
    try{
      const raw = localStorage.getItem(MSG_KEY);
      if (raw) msgFlags = { ...msgFlags, ...JSON.parse(raw) };
    }catch(_){}
  }

  function saveMsgFlags(){
    localStorage.setItem(MSG_KEY, JSON.stringify(msgFlags));
  }

  function updateSwitchesUI(){
    document.querySelectorAll(".switch[data-key]").forEach(sw=>{
      const key = sw.getAttribute("data-key");
      sw.classList.toggle("on", !!msgFlags[key]);
    });
  }

  function updateMessageSample(){
    const lang = document.documentElement.lang || "fr";
    const sample = document.getElementById("msgSample");
    if (!sample) return;

    // choose message based on priority: alert > watch > normal > sensor
    if (msgFlags.m3){
      sample.textContent = (lang==="en")
        ? "Alert: a critical value was detected. Please contact a healthcare professional immediately."
        : "Alerte : une valeur critique a √©t√© d√©tect√©e. Merci de contacter un professionnel de sant√© imm√©diatement.";
      return;
    }
    if (msgFlags.m2){
      sample.textContent = (lang==="en")
        ? "Attention: please re-measure after 10 minutes of rest. If it persists, contact the clinic."
        : "√Ä surveiller : merci de refaire une mesure apr√®s 10 minutes de repos. Si cela persiste, contactez le cabinet.";
      return;
    }
    if (msgFlags.m1){
      sample.textContent = (lang==="en")
        ? "Good news: your readings are normal. Keep up your healthy routine."
        : "Bonne nouvelle : vos mesures sont normales. Continuez vos habitudes.";
      return;
    }
    if (msgFlags.m4){
      sample.textContent = (lang==="en")
        ? "Sensor placement: please reposition the sensor and retry the measurement."
        : "Placement capteur : merci de repositionner le capteur puis de relancer la mesure.";
      return;
    }
    sample.textContent = (lang==="en")
      ? "No automatic messages are enabled."
      : "Aucun message automatique n‚Äôest activ√©.";
  }

  // =========================
  // INIT
  // =========================
  function initPreferences(){
    const themeSelect=document.getElementById("themeSelect");
    const langSelect=document.getElementById("langSelect");

    const savedTheme=localStorage.getItem(THEME_KEY) || "light";
    const savedLang=localStorage.getItem(LANG_KEY) || "fr";

    themeSelect.value=savedTheme;
    langSelect.value=savedLang;

    setTheme(savedTheme);
    setLang(savedLang);

    themeSelect.addEventListener("change", (e)=> setTheme(e.target.value));
    langSelect.addEventListener("change", (e)=> setLang(e.target.value));
  }

  function initPatientsUI(){
    document.getElementById("searchPatient").addEventListener("input", renderPatientsTable);
    document.getElementById("filterStatus").addEventListener("change", renderPatientsTable);
    document.getElementById("sortPatients").addEventListener("change", renderPatientsTable);
    renderPatientsTable();
  }

  function initButtons(){
    document.getElementById("btnStartDemo").addEventListener("click", startDemo);
    document.getElementById("btnStopDemo").addEventListener("click", stopDemo);

    document.getElementById("btnGoPatients").addEventListener("click", ()=> setActivePage("patients"));
  }

  function initMessages(){
    loadMsgFlags();
    updateSwitchesUI();
    updateMessageSample();

    document.querySelectorAll(".switch[data-key]").forEach(sw=>{
      sw.addEventListener("click", ()=>{
        const key = sw.getAttribute("data-key");
        msgFlags[key] = !msgFlags[key];
        sw.classList.toggle("on", msgFlags[key]);
        saveMsgFlags();
        updateMessageSample();
      });
    });

    document.getElementById("btnPreviewMsg").addEventListener("click", ()=>{
      updateMessageSample();
      // small visual cue
      const el = document.getElementById("msgSample");
      el.style.transition = "transform .15s ease";
      el.style.transform = "scale(1.02)";
      setTimeout(()=> el.style.transform="scale(1)", 160);
    });
  }

  function boot(){
    initNav();
    initPreferences();
    initPatientsUI();
    initButtons();
    initMessages();

    // init live chart dataset
    bpLiveData = { labels: [], sys: [], dia: [] };
    rebuildBpLiveIfNeeded();

    // load last selected patient or default
    const savedId = localStorage.getItem(SELECTED_KEY) || patients[0].id;
    loadPatientById(savedId);
  }

  boot();
</script>
</body>
</html>
